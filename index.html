<video id="video" controls muted></video>
<button id="playButton">Play</button>
<div id="log"></div>

<script>
  const video = document.getElementById('video');
  const logDiv = document.getElementById('log');
  function log(msg) {
    console.log(msg);
    logDiv.textContent += msg + '\n';
  }

  async function initPlayer() {
    const manifestUri = "https://qp-pldt-live-grp-04-prod.akamaized.net/out/u/pbo_sd.mpd";
    const player = new shaka.Player(video);

    player.addEventListener('error', (event) => {
      log('Error code ' + event.detail.code + ': ' + event.detail.message);
    });

    player.configure({
      drm: {
        clearKeys: {
          "3L2pZmLUGIvflfnwyl6DA": "MeVStQb0pXPLmKRs8HHoQ"
        }
      }
    });

    try {
      log('Loading manifest...');
      await player.load(manifestUri);
      log('Video loaded successfully');
      // Delay play to avoid race conditions
      setTimeout(() => {
        video.play().catch(e => log('Video play() failed: ' + e.message));
      }, 500);
    } catch (e) {
      log('Error loading or playing video: ' + e);
    }
  }

  document.getElementById('playButton').addEventListener('click', async () => {
    try {
      await video.play();
      log('Video playing after user interaction');
    } catch (e) {
      log('Play failed: ' + e.message);
    }
  });

  document.addEventListener('DOMContentLoaded', initPlayer);
</script>
